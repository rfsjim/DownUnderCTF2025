# Kick the Bucket
**Category** - <span style="color:blue;">Beginner</span>

## Challenge Text
In this challenge, CI/CD pipelines and Terraform are being used to manage AWS resources. Part of this infrastructure utilises an S3 bucket, which is used to stage files and configuration. Being security conscious individuals, the admins have prevented misuse of this bucket by configuring access only to Terraform. They are also using S3 presigned URLs to provide timeboxed access to certain files without sharing credentials.

Given a presigned URL for flag.txt (generated by the CI/CD pipeline user), and the resource policy applied to the S3 bucket, find a way to get at the flag!

If you need a primer on some of the AWS concepts at play here:

https://docs.aws.amazon.com/AmazonS3/latest/userguide/ShareObjectPreSignedURL.html
https://docs.aws.amazon.com/AmazonS3/latest/userguide/example-bucket-policies.html
https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html#policy-eval-basics-id-rdp
Regards,
gyrospectre

## Goal
Get `flag.txt` from the S3 bucket.

## Initial Observations
Two files are given
* `s3_presigned_url.txt`: Just the URL with the flag, and
* `s3_resource_policy.txt`

### s3_presigned_url.txt
Is a time-limited URL that:
* Grants temporary access to an object (e.g., `flag.txt`)
* Is signed with a valid IAM user's credentials (likely the CI/CD user)
* Can bypass the bucket policy, depending on the configuration

### s3_resource_policy.txt
The policy was
```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": [
        "arn:aws:s3:::kickme-95f596ff5b61453187fbc1c9faa3052e/flag.txt",
        "arn:aws:s3:::kickme-95f596ff5b61453187fbc1c9faa3052e"
      ],
      "Principal": {
        "AWS": "arn:aws:iam::487266254163:user/pipeline"
      },
      "Condition": {
        "StringLike": {
          "aws:UserAgent": "aws-sdk-go*"
        }
      }
    }
  ]
}
```

## Steps Taken
1. Use `curl <URL>` to see if I got lucky and could access the flag straight away
2. No dice, not surpirsed it is a CTF challenge after all.
3. I notice in the policy that in the `Condition` block there is a parameter for `aws:UserAgent` being `aws-sdk-go*`, this means that if I could send the right User-Agent header then I would be able to access the flag
4. Use `curl -A "aws-sdk-go" "<URL>"`
5. Success flag received